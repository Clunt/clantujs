/*!
 * Clantujs v1.0.0
 * (c) 2016 Clunt
 * Released under the MIT License.
 */
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.C=n()}(this,function(){"use strict";function t(t,n){var e=t.match(/(\?.*)$/);if(e&&(e=e[1],t=t.slice(0,-e.length)),"?"===n.charAt(0))return t+n;var o=t.split("/");o[o.length-1]||o.pop();for(var r=n.replace(/^\//,"").split("/"),i=0;i<r.length;i++){var a=r[i];"."!==a&&(".."===a?o.pop():o.push(a))}return""!==o[0]&&o.unshift(""),o.join("/")}function n(t,n,e){t&&t.addEventListener?t.addEventListener(n,e,!1):t&&t.attachEvent&&t.attachEvent("on"+n,e)}function e(t){t.preventDefault?t.preventDefault():t.returnValue=!1}function o(t){for(var n,e=[],o=0,r=0,a="";null!=(n=L.exec(t));){var h=n[0],s=n[1],c=n.index;if(a+=t.slice(r,c),r=c+h.length,s)a+=s[1];else{var u=t[r],f=n[2],l=n[3],p=n[4],v=n[5],d=n[6],y=n[7];a&&(e.push(a),a="");var g=null!=f&&null!=u&&u!==f,m="+"===d||"*"===d,w="?"===d||"*"===d,x=n[2]||"/",E=p||v||(y?".*":"[^"+x+"]+?");e.push({name:l||o++,prefix:f||"",delimiter:x,optional:w,repeat:m,partial:g,asterisk:!!y,pattern:i(E)})}}return r<t.length&&(a+=t.substr(r)),a&&e.push(a),e}function r(t){return t.replace(/([.+*?=^!:${}()[\]|\/\\])/g,"\\$1")}function i(t){return t.replace(/([=!:$\/()])/g,"\\$1")}function a(t,n){return t.keys=n,t}function h(t){return t.sensitive?"":"i"}function s(t,n){var e=t.source.match(/\((?!\?)/g);if(e)for(var o=0;o<e.length;o++)n.push({name:o,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,asterisk:!1,pattern:null});return a(t,n)}function c(t,n,e){for(var o=[],r=0;r<t.length;r++)o.push(l(t[r],n,e).source);var i=new RegExp("(?:"+o.join("|")+")",h(e));return a(i,n)}function u(t,n,e){for(var r=o(t),i=f(r,e),h=0;h<r.length;h++)"string"!=typeof r[h]&&n.push(r[h]);return a(i,n)}function f(t,n){n=n||{};for(var e=n.strict,o=n.end!==!1,i="",a=t[t.length-1],s="string"==typeof a&&/\/$/.test(a),c=0;c<t.length;c++){var u=t[c];if("string"==typeof u)i+=r(u);else{var f=r(u.prefix),l="(?:"+u.pattern+")";u.repeat&&(l+="(?:"+f+l+")*"),l=u.optional?u.partial?f+"("+l+")?":"(?:"+f+"("+l+"))?":f+"("+l+")",i+=l}}return e||(i=(s?i.slice(0,-2):i)+"(?:\\/(?=$))?"),i+=o?"$":e&&s?"":"(?=\\/|$)",new RegExp("^"+i,h(n))}function l(t,n,e){return n=n||[],P(n)?e||(e={}):(e=n,n=[]),t instanceof RegExp?s(t,n):P(t)?c(t,n,e):u(t,n,e)}function p(t){this.path="*"===t?"(.*)":t,this.keys=[],this.regexp=l(this.path,this.keys)}function v(t){for(var n={},e=t.split("&"),o=0;o<e.length;o++){var r=e[o];if(0!==r.length){var i=r.split("="),a=i.shift(),h=i.length>0?i.join("="):void 0;h=void 0===h?null:h,void 0===n[a]?n[a]=h:P(n[a])?n[a].push(h):n[a]=[n[a],h]}}return n}function d(t,n){this.state=n||{},this.path=t,this.params={};var e=t,o=e.indexOf("#");this.hash=~o?e.slice(o+1):"",e=~o?e.slice(0,o):e;var r=e.indexOf("?");this.querystring=~r?e.slice(r+1):"",e=~r?e.slice(0,r):e,this.query=v(this.querystring),this.pathname=e}function y(t,n){function e(){var t=N[h++];return t?void t(i,e):o()}function o(){var t=_[a++];r.path===O&&t&&t(r,o)}var r=new d(t,n);O=r.path;var i=j,a=0,h=0;return j=r,i?e():o(),r}function g(t,n){if("function"==typeof t)return g("*",t);if("function"==typeof n)for(var e=new p(t),o=1;o<arguments.length;++o)_.push(e.middleware(arguments[o]))}function m(t){this.onChange=t.onChange}function w(t){this.onChange=t.onChange;var n=t.root;t.root?("/"!==n.charAt(0)&&(n="/"+n),this.root=n.replace(/\/$/,""),this.rootRE=new RegExp("^\\"+this.root)):this.root=null;var e=document.getElementsByTagName("base")[0];this.base=e&&e.getAttribute("href")}function x(t){return t=t||window.event,null===t.which?t.button:t.which}function E(t){var n=location.protocol+"//"+location.hostname;return location.port&&(n+=":"+location.port),t&&0===t.indexOf(n)}function k(t){this.onClick=t.onClick}function b(t){if(t=t||{},!(this instanceof b))return new b(t);var n=this;this.running=!1;var e="undefined"==typeof t.root?null:t.root;this.root=e;var o="undefined"!=typeof window&&window.history&&window.history.pushState;this._history=t.history&&o,this._historyFallback=t.history&&!o,this.mode=this._history?"html5":"hash";var r=U[this.mode];this.history=new r({root:e,onChange:function(t,n){S.match(t,n)}}),this.link=new k({onClick:function(t){n._history&&0===t.indexOf("#")?location.hash=t:n.go(t)}})}function A(t){return q||(q=new b(t)),q}var R={}.toString,C=document.removeEventListener?function(t,n,e){t.removeEventListener&&t.removeEventListener(n,e,!1)}:function(t,n,e){var o="on"+type;t.detachEvent&&("undefined"==typeof t[o]&&(t[o]=null),t.detachEvent(o,e))},$=function(){function t(t){for(var n=0;n<i.length;n++){var e=i[n];"function"==typeof e&&e(t)}}function e(){if(!r){var n=window.location,e=n.href,o=n.hash;r=setInterval(function(){var r=n.href,i=n.hash;i!=o&&(t({type:"hashchange",oldURL:e,newURL:r}),e=r,o=i)},100)}}var o=!(!("onhashchange"in window)&&(void 0===document.documentMode||document.documentMode>7)),o=!1,r=null,i=[],a={bind:function(t){n(window,"hashchange",t)},remove:function(t){C(window,"hashchange",t)}},h={bind:function(t){i.push(t),e()},remove:function(t){for(var n=0;n<i.length;n++)t===i[n](evt)&&(i[n]=null)}};return o?a:h}(),P=Array.isArray||function(t){return"[object Array]"==R.call(t)},L=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))"].join("|"),"g");p.prototype.middleware=function(t){var n=this;return function(e,o){return n.match(e,e.params)?t(e,o):void o()}},p.prototype.match=function(t,n){var e=this.keys,o=t.pathname,r=this.regexp.exec(o);if(!r)return!1;for(var i=1,a=r.length;i<a;++i){var h=e[i-1],s=r[i];void 0===s&&hasOwnProperty.call(n,h.name)||(n[h.name]=s)}return!0};var j,O="",_=[],N=[];g.exit=function t(n,e){if("function"==typeof n)return t("*",n);if("function"==typeof e)for(var o=new p(n),r=1;r<arguments.length;++r)N.push(o.middleware(arguments[r]))};var S={register:g,match:y};m.prototype.start=function(){var t=this;this.listener=function(){var n=location.hash,e=n.replace(/^#!/,"");"/"!==e.charAt(0)&&(e="/"+e);var o=t.formatPath(e);return o!==n?void location.replace(o):void t.onChange(decodeURI(n.replace(/^#!/,"")))},$.bind(this.listener),this.listener()},m.prototype.stop=function(){$.remove(this.listener)},m.prototype.go=function(t,n){t=this.formatPath(t),location.hash=t},m.prototype.formatPath=function(n){var e="#!";return"/"===n.charAt(0)?e+n:e+t(location.hash.replace(/^#!/,""),n)},w.prototype.start=function(){var t=this;this.listener=function(n){var e=decodeURI(location.pathname+location.search)+location.hash;t.root&&(e=e.replace(t.rootRE,"")),t.onChange(e,n&&n.state)},n(window,"popstate",this.listener),this.listener()},w.prototype.stop=function(){C(window,"popstate",this.listener)},w.prototype.go=function(t,n){var e=this.formatPath(t);n?history.replaceState({},"",e):history.pushState({},"",e),this.onChange(e.replace(this.rootRE,""),null)},w.prototype.formatPath=function(n){return"/"===n.charAt(0)?this.root?this.root+"/"+n.replace(/^\//,""):n:t(this.base||location.pathname,n)},k.prototype.start=function(){var t=this;this.listener=function(n){if(1===x(n)&&!(n.metaKey||n.ctrlKey||n.shiftKey||n.defaultPrevented)){for(var o=n.target;o&&"A"!==o.nodeName;)o=o.parentNode;if(o&&"A"===o.nodeName&&!o.hasAttribute("download")&&"external"!==o.getAttribute("rel")){var r=o.getAttribute("href");if(!(r&&r.indexOf("mailto:")>-1)&&!o.target&&E(o.href)){o.pathname+o.search+(o.hash||"");e(n),t.onClick(r)}}}},n(document,"click",this.listener)},k.prototype.stop=function(){C(document,"click",this.listener)};var U={hash:m,html5:w},q=null;return b.prototype.router=S.register,b.prototype.start=function(t){if(!this.running){this.running=!0;var n=window.location;if(this._historyFallback){var e=new w({root:this.root}),o=e.root?n.pathname.replace(e.rootRE,""):n.pathname;if(o&&"/"!==o||n.search){this.history.formatPath(o);return void n.assign((e.root||"")+"/"+this.history.formatPath(o)+n.search+n.hash)}}if(this._history){var r=n.pathname.replace(/\/$/,"")+"/"+n.search+n.hash,i=new RegExp("^\\"+this.history.root+"/#!/");if(i.test(r))return void n.assign((this.history.root||"")+"/"+n.hash.replace(/^#!\/?/,""))}this.link.start(),this.history.start()}},b.prototype.stop=function(){this.history.stop(),this.link.stop(),this.running=!1},b.prototype.show=function(t){S.match(t)},b.prototype.go=function(t){this.history.go(t)},b.prototype.replace=function(t){this.history.go(t,!0)},A});
