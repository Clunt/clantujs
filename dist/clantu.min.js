/*!
 * Clantujs v2.1.0
 * (c) 2016 Clunt
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Clantu=e()}(this,function(){"use strict";function t(t,e,n){t&&t.addEventListener?t.addEventListener(e,n,!1):t&&t.attachEvent&&t.attachEvent("on"+e,n)}function e(t){t.preventDefault?t.preventDefault():t.returnValue=!1}function n(t){t="object"==typeof t?t:{};var e=arguments;if(e.length>1)for(var r=1;r<e.length;r++){var i=e[r];if("object"==typeof i&&!K(i))for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];t[o]="object"==typeof a?n(t[o],a):a}}return t}function r(t){for(var e,n=[],r=0,i=0,a="";null!=(e=q.exec(t));){var s=e[0],c=e[1],h=e.index;if(a+=t.slice(i,h),i=h+s.length,c)a+=c[1];else{var l=t[i],u=e[2],f=e[3],p=e[4],v=e[5],d=e[6],g=e[7];a&&(n.push(a),a="");var y=null!=u&&null!=l&&l!==u,m="+"===d||"*"===d,$="?"===d||"*"===d,w=e[2]||"/",b=p||v||(g?".*":"[^"+w+"]+?");n.push({name:f||r++,prefix:u||"",delimiter:w,optional:$,repeat:m,partial:y,asterisk:!!g,pattern:o(b)})}}return i<t.length&&(a+=t.substr(i)),a&&n.push(a),n}function i(t){return t.replace(/([.+*?=^!:${}()[\]|\/\\])/g,"\\$1")}function o(t){return t.replace(/([=!:$\/()])/g,"\\$1")}function a(t,e){return t.keys=e,t}function s(t){return t.sensitive?"":"i"}function c(t,e){var n=t.source.match(/\((?!\?)/g);if(n)for(var r=0;r<n.length;r++)e.push({name:r,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,asterisk:!1,pattern:null});return a(t,e)}function h(t,e,n){for(var r=[],i=0;i<t.length;i++)r.push(f(t[i],e,n).source);var o=new RegExp("(?:"+r.join("|")+")",s(n));return a(o,e)}function l(t,e,n){for(var i=r(t),o=u(i,n),s=0;s<i.length;s++)"string"!=typeof i[s]&&e.push(i[s]);return a(o,e)}function u(t,e){e=e||{};for(var n=e.strict,r=e.end!==!1,o="",a=t[t.length-1],c="string"==typeof a&&/\/$/.test(a),h=0;h<t.length;h++){var l=t[h];if("string"==typeof l)o+=i(l);else{var u=i(l.prefix),f="(?:"+l.pattern+")";l.repeat&&(f+="(?:"+u+f+")*"),f=l.optional?l.partial?u+"("+f+")?":"(?:"+u+"("+f+"))?":u+"("+f+")",o+=f}}return n||(o=(c?o.slice(0,-2):o)+"(?:\\/(?=$))?"),o+=r?"$":n&&c?"":"(?=\\/|$)",new RegExp("^"+o,s(e))}function f(t,e,n){return e=e||[],K(e)?n||(n={}):(n=e,e=[]),t instanceof RegExp?c(t,e):K(t)?h(t,e,n):l(t,e,n)}function p(t){this.path="*"===t?"(.*)":t,this.keys=[],this.regexp=f(this.path,this.keys)}function v(t){for(var e={},n=t.split("&"),r=0;r<n.length;r++){var i=n[r];if(0!==i.length){var o=i.split("="),a=o.shift(),s=o.length>0?o.join("="):void 0;s=void 0===s?null:s,void 0===e[a]?e[a]=s:K(e[a])?e[a].push(s):e[a]=[e[a],s]}}return e}function d(t){var e="Template Error\n\n";for(var n in t)e+="<"+n+">\n"+t[n]+"\n\n";W.debug&&"object"==typeof console&&console.error(e)}function g(t){return M.cache[t]}function y(t){var e="partial:"+t,n=g(e);if(!n){var r=M.partials[t];r&&(n=b(r,{filename:e}))}return n}function m(t){return t.replace(nt,"").replace(rt,",").replace(it,"").replace(ot,"").replace(at,"").split(st)}function $(t){return"'"+t.replace(/('|\\)/g,"\\$1").replace(/\r/g,"\\r").replace(/\n/g,"\\n")+"'"}function w(t,e){function n(t){return l+=t.split(/\n/).length-1,c&&(t=t.replace(/\s+/g," ").replace(/<!--[\w\W]*?-->/g,"")),t&&(t=p[1]+$(t)+p[2]+"\n"),t}function r(t){var n=l;if(s?t=s(t,e):i&&(t=t.replace(/\n/g,function(){return l++,"$line="+l+";"})),0===t.indexOf("=")){var r=h&&!/^=[=#]/.test(t);if(t=t.replace(/^=[=#]?|[\s;]*$/g,""),r){var o=t.replace(/\s*\([^\)]+\)/,"");Z[o]||/^(include|print)$/.test(o)||(t="$escape("+t+")")}else t="$string("+t+")";t=p[1]+t+p[2]}return i&&(t="$line="+n+";"+t),tt(m(t),function(t){if(t&&!u[t]){var e;e="print"===t?d:"include"===t?g:Z[t]?"$utils."+t:"$data."+t,y+=t+"="+e+",",u[t]=!0}}),t+"\n"}var i=W.debug,o=e.openTag,a=e.closeTag,s=e.parser,c=e.compress,h=e.escape,l=1,u={$data:1,$filename:1,$utils:1,$helpers:1,$out:1,$line:1},f="".trim,p=f?["$out='';","$out+=",";","$out"]:["$out=[];","$out.push(",");","$out.join('')"],v=f?"$out+=text;return $out;":"$out.push(text);",d="function(){var text=''.concat.apply('',arguments);"+v+"}",g="function(filename,data){data=data||$data;var text=$utils.$include(filename,data,$filename);"+v+"}",y="'use strict';var $utils=this,$helpers=$utils.$helpers,"+(i?"$line=0,":""),w=p[0],b="return new String("+p[3]+");";tt(t.split(o),function(t){t=t.split(a);var e=t[0],i=t[1];1===t.length?w+=n(e):(w+=r(e),i&&(w+=n(i)))});var x=y+w+b;i&&(x="try{"+x+"}catch(e){throw {filename:$filename,name:'Render Error',message:e.message,line:$line,source:"+$(t)+".split(/\\n/)[$line-1].replace(/^\\s+/,'')};}");try{var k=new Function("$data","$filename",x);return k.prototype=Z,k}catch(t){throw t.temp="function anonymous($data,$filename) {"+x+"}",t}}function b(t,e){function r(t){try{return new o(t)+""}catch(t){return V(t)()}}e=n({},z,e);var i=e.filename;try{var o=w(t,e)}catch(t){return t.filename=i||"anonymous",t.name="Syntax Error",V(t)}return r.prototype=o.prototype,r.toString=function(){return o.toString()},i&&e.cache&&(M.cache[i]=r),r}function x(t,e,n){"string"==typeof n&&(n={filename:n}),n=n||{},n.cache===!1&&(M[n.filename]=void 0);var r=g(n.filename)||b(t,n);return r(e)}function k(t,e){M.helpers[t]=e}function E(t,e){M.partials[t]=e}function j(t,e){return"string"==typeof e&&(e={filename:e}),e=e||{},e.cache===!1&&(M[e.filename]=void 0),g(e.filename)||b(t,e)}function R(t,e,n,r){var i=t,o=i.indexOf("#"),a=~o?i.slice(o+1):"";i=~o?i.slice(0,o):i;var s=i.indexOf("?"),c=~s?i.slice(s+1):"";i=~s?i.slice(0,s):i;var h=v(c);this.$state=e||{},this.$path=t,this.$params={},this.$pathname=i,this.$hash=a,this.$querystring=c,this.$query=h,this.$referer=n,this.$prev=r,this.$render=x}function A(t,e){function n(){var t=ut[s++];return t?void t(o,n):r()}function r(){var t=lt[a++];i.$path===ht&&t&&t(i,r)}var i=new R(t,e,ht,ct);ht=i.$path;var o=ct,a=0,s=0;return ct=i,o?n():r(),i}function C(t,e){if("function"==typeof t)return C("*",t);if("function"==typeof e)for(var n=new p(t),r=1;r<arguments.length;++r)lt.push(n.middleware(arguments[r]))}function P(t,e){var n=t.match(/(\?.*)$/);if(n&&(n=n[1],t=t.slice(0,-n.length)),"?"===e.charAt(0))return t+e;var r=t.split("/");r[r.length-1]||r.pop();for(var i=e.replace(/^\//,"").split("/"),o=0;o<i.length;o++){var a=i[o];"."!==a&&(".."===a?r.pop():r.push(a))}return""!==r[0]&&r.unshift(""),r.join("/")}function O(t){this.onChange=t.onChange}function S(t){this.onChange=t.onChange;var e=t.root;t.root?("/"!==e.charAt(0)&&(e="/"+e),this.root=e.replace(/\/$/,""),this.rootRE=new RegExp("^\\"+this.root)):this.root=null;var n=document.getElementsByTagName("base")[0];this.base=n&&n.getAttribute("href")}function L(t){return t=t||window.event,null===t.which?t.button:t.which}function T(t){var e=location.protocol+"//"+location.hostname;return location.port&&(e+=":"+location.port),t&&0===t.indexOf(e)}function _(t){this.onClick=t.onClick}function I(t,e){t=t||{};var n=this,r="undefined"==typeof t.root?null:t.root;this.root=r;var i="undefined"!=typeof window&&window.history&&window.history.pushState;this._history=t.history&&i,this._historyFallback=t.history&&!i,this.mode=this._history?"html5":"hash";var o=pt[this.mode];this.history=new o({root:r,onChange:e}),this.link=new _({onClick:function(t){n.history.go(t)}})}function N(t){t=n(W,t);this.running=!1,this.listener=new I(t.listener,function(t,e){A(t,e)})}function U(t){return vt||(vt=new N(t))}var W={debug:!1,listener:{root:null,history:!1}},D={}.toString,F=document.removeEventListener?function(t,e,n){t.removeEventListener&&t.removeEventListener(e,n,!1)}:function(t,e,n){var r="on"+type;t.detachEvent&&("undefined"==typeof t[r]&&(t[r]=null),t.detachEvent(r,n))},K=Array.isArray||function(t){return"[object Array]"==D.call(t)},q=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))"].join("|"),"g");p.prototype.middleware=function(t){var e=this;return function(n,r){return e.match(n,n.$params)?t(n,r):void r()}},p.prototype.match=function(t,e){var n=this.keys,r=t.$pathname,i=this.regexp.exec(r);if(!i)return!1;for(var o=1,a=i.length;o<a;++o){var s=n[o-1],c=i[o];void 0===c&&hasOwnProperty.call(e,s.name)||(e[s.name]=c)}return!0};var M={cache:{},helpers:{},partials:{}},z={openTag:"{{",closeTag:"}}",escape:!0,cache:!0,compress:!1,parser:null},B=function(t,e){var n=e.split(":"),r=n.shift(),i=n.join(":")||"";return i&&(i=", "+i),"$helpers."+r+"("+t+i+")"};z.parser=function(t,e){t=t.replace(/^\s/,"");var n=t.split(" "),r=n.shift(),i=n.join(" ");switch(r){case"if":t="if("+i+"){";break;case"else":n="if"===n.shift()?" if("+n.join(" ")+")":"",t="}else"+n+"{";break;case"/if":t="}";break;case"each":var o=n[0]||"$data",a=n[1]||"as",s=n[2]||"$value",c=n[3]||"$index",h=s+","+c;"as"!==a&&(o="[]"),t="$each("+o+",function("+h+"){";break;case"/each":t="});";break;case"echo":t="print("+i+");";break;case"print":case"include":t=r+"("+n.join(",")+");";break;default:if(/^\s*\|\s*[\w\$]/.test(i)){var l=!0;0===t.indexOf("#")&&(t=t.substr(1),l=!1);for(var u=0,f=t.split("|"),p=f.length,v=f[u++];u<p;u++)v=B(v,f[u]);t=(l?"=":"=#")+v}else t="="+t}return t};var V=function(t){return d(t),function(){return"{Template Error}"}},G=function(t,e){return"string"!=typeof t&&(e=typeof t,"number"===e?t+="":t="function"===e?G(t.call(t)):""),t},H={"<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","&":"&#38;"},J=function(t){return H[t]},Q=function(t){return G(t).replace(/&(?![\w#]+;)|[<>"']/g,J)},X=function(t,e){var n,r;if(K(t))for(n=0,r=t.length;n<r;n++)e.call(t,t[n],n,t);else for(n in t)e.call(t,t[n],n)},Y=function(t,e){var n=y(t)||showDebugInfo({partial:t,name:"Render Error",message:"Partial not found"});return e?n(e):n},Z={$helpers:M.helpers,$include:Y,$string:G,$escape:Q,$each:X},tt=Z.$each,et=["break","case","catch","continue","debugger","default","delete","do","else","false","finally","for","function","if","in","instanceof","new","null","return","switch","this","throw","true","try","typeof","var","void","while","with","abstract","boolean","byte","char","class","const","double","enum","export","extends","final","float","goto","implements","import","int","interface","long","native","package","private","protected","public","short","static","super","synchronized","throws","transient","volatile","arguments","let","yield","undefined"],nt=/\/\*[\w\W]*?\*\/|\/\/[^\n]*\n|\/\/[^\n]*$|"(?:[^"\\]|\\[\w\W])*"|'(?:[^'\\]|\\[\w\W])*'|\s*\.\s*[$\w\.]+/g,rt=/[^\w$]+/g,it=new RegExp(["\\b"+et.join("\\b|\\b")+"\\b"].join("|"),"g"),ot=/^\d[^,]*|,\d[^,]*/g,at=/^,+|,+$/g,st=/^$|,+/;j.render=x,j.helper=k,j.partial=E;var ct,ht="",lt=[],ut=[];C.exit=function t(e,n){if("function"==typeof e)return t("*",e);if("function"==typeof n)for(var r=new p(e),i=1;i<arguments.length;++i)ut.push(r.middleware(arguments[i]))};var ft=function(){function e(t){for(var e=0;e<o.length;e++){var n=o[e];"function"==typeof n&&n(t)}}function n(){if(!i){var t=window.location,n=t.href,r=t.hash;i=setInterval(function(){var i=t.href,o=t.hash;o!=r&&(e({type:"hashchange",oldURL:n,newURL:i}),n=i,r=o)},100)}}var r=!(!("onhashchange"in window)&&(void 0===document.documentMode||document.documentMode>7)),r=!1,i=null,o=[],a={bind:function(e){t(window,"hashchange",e)},remove:function(t){F(window,"hashchange",t)}},s={bind:function(t){o.push(t),n()},remove:function(t){for(var e=0;e<o.length;e++)t===o[e](evt)&&(o[e]=null)}};return r?a:s}();O.prototype.start=function(){var t=this;this.listener=function(){var e=location.hash,n=e.replace(/^#!/,"");"/"!==n.charAt(0)&&(n="/"+n);var r=t.formatPath(n);return r!==e?void location.replace(r):void t.onChange(decodeURI(e.replace(/^#!/,"")))},ft.bind(this.listener),this.listener()},O.prototype.stop=function(){ft.remove(this.listener)},O.prototype.go=function(t,e){var n=window.location;return 0===t.indexOf("#")?void(n.hash="#!"+n.hash.replace(/^#!/,"").replace(/#.*/g,"")+t):(t=this.formatPath(t),void(n.hash=t))},O.prototype.formatPath=function(t){var e="#!";return"/"===t.charAt(0)?e+t:e+P(location.hash.replace(/^#!/,""),t)},S.prototype.start=function(){var e=this;this.listener=function(t){var n=decodeURI(location.pathname+location.search)+location.hash;e.root&&(n=n.replace(e.rootRE,"")),e.onChange(n,t&&t.state)},t(window,"popstate",this.listener),this.listener()},S.prototype.stop=function(){F(window,"popstate",this.listener)},S.prototype.go=function(t,e){if(0===t.indexOf("#"))return void(window.location.hash=t);var n=this.formatPath(t);e?history.replaceState({},"",n):history.pushState({},"",n),this.onChange(n.replace(this.rootRE,""),null)},S.prototype.formatPath=function(t){return"/"===t.charAt(0)?this.root?this.root+"/"+t.replace(/^\//,""):t:P(this.base||location.pathname,t)},_.prototype.start=function(){var n=this;this.listener=function(t){if(1===L(t)&&!(t.metaKey||t.ctrlKey||t.shiftKey||t.defaultPrevented)){for(var r=t.target;r&&"A"!==r.nodeName;)r=r.parentNode;if(r&&"A"===r.nodeName&&!r.hasAttribute("download")&&"external"!==r.getAttribute("rel")){var i=r.getAttribute("href");if(!(i&&i.indexOf("mailto:")>-1)&&!r.target&&T(r.href)){r.pathname+r.search+(r.hash||"");e(t),n.onClick(i)}}}},t(document,"click",this.listener)},_.prototype.stop=function(){F(document,"click",this.listener)};var pt={hash:O,html5:S};I.prototype.start=function(){var t=window.location;if(this._historyFallback){var e=new S({root:this.root}),n=e.root?t.pathname.replace(e.rootRE,""):t.pathname;if(n&&"/"!==n||t.search){this.history.formatPath(n);return void t.assign((e.root||"")+"/"+this.history.formatPath(n)+t.search+t.hash)}}if(this._history){var r=t.pathname.replace(/\/$/,"")+"/"+t.search+t.hash,i=new RegExp("^\\"+this.history.root+"/#!/");if(i.test(r))return void t.assign((this.history.root||"")+"/"+t.hash.replace(/^#!\/?/,""))}this.history.start(),this.link.start()},I.prototype.stop=function(){this.history.stop(),this.link.stop(),this.running=!1};var vt=null,dt=C;return N.prototype.router=dt,N.prototype.template=j,N.prototype.render=x,N.prototype.start=function(t){this.running||(this.running=!0,this.listener.start())},N.prototype.stop=function(){this.listener.stop(),this.running=!1},N.prototype.show=function(t){A(t)},N.prototype.go=function(t){this.listener.history.go(t)},N.prototype.replace=function(t){this.listener.history.go(t,!0)},U.router=dt,U.template=j,U.render=x,U});